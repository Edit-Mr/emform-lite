<!-- @format -->

<!DOCTYPE html>
<html lang="zh-hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>中電會第四屆成員招募</title>
        <link rel="stylesheet" href="/static/css/form.css" />
        <link rel="stylesheet" href="/static/css/ball.css" />
        <link rel="stylesheet" href="/static/css/element.css" />
    </head>

    <body>
        <form id="user-form">
            <main>
                <section>
                    <div class="question intro noNav">
                        <div class="question-box">
                            <h1>中部電資聯合會議 第四屆成員招募</h1>
                            <div class="author">
                                <img
                                    src="https://scaict.org/src/img/apple-touch-icon.png"
                                    alt="author thumbnail"
                                />SCAICT 中電會 製作
                            </div>
                            <div class="history">
                                你似乎填寫這份表單到一半。不用擔心!
                                我們已經幫你保存了進度，你可以繼續填寫。
                            </div>
                            <div class="highlight">
                                自 2021
                                年成立以來，我們致力於整合中部地區的資訊科技資源，推廣相關課程與活動。<br />我們正在招募第四屆成員，如果你熱愛資訊科技，喜歡參與社團活動，趕快填寫表單加入我們吧！
                            </div>
                            <h2>召募對象</h2>
                            <p>對資訊科技有興趣之全台各地高中職及五專生。</p>
                            <h2>各組負責事項</h2>
                            <ul>
                                <li><strong>會長</strong>：統籌各項事務</li>
                                <li><strong>副會長</strong>：協助會長事務</li>
                                <li>
                                    <strong>資訊組</strong
                                    >：有資訊實力並願意學習或教學
                                </li>
                                <li><strong>活動組</strong>：規劃各項活動</li>
                                <li>
                                    <strong>公關組</strong
                                    >：平面設計、IG宣傳、廠商接洽、課程通知
                                </li>
                                <li>
                                    <strong>總務組</strong>：管理支出及各項金流
                                </li>
                                <li>
                                    <strong>臨時工人</strong
                                    >：主要為無法定期開會或參與活動但仍想加入的成員
                                </li>
                            </ul>
                            <h2>選幹篩選標準</h2>
                            <p>
                                一般幹部/組長及新任正副會長將由第四屆 第0會時
                                進行投票表決。<br />
                                志願說明欄位請如實詳細作答讓我們更了解你。
                            </p>
                            <h2>注意事項</h2>
                            <p>
                                報名截止日期:8/17(四)<br />
                                正式名單將於9月前後寄出，敬請收信。<br />
                                請先衡量是否具有時間配合開會，開會時間暫定為周六晚上九點
                                (可討論)，如有困難，也可以擔任臨時工人。
                            </p>
                            <div class="start">
                                <button class="next discord" id="loginBtn">
                                    登入 Discord 以繼續
                                </button>
                            </div>
                            <div class="must">
                                此份表單必須使用 Discord 登入才能填寫。
                            </div>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題1:</div>
                            <h2>姓名</h2>
                            <p>請填寫中文全名</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="王朝立"
                                    name="name"
                                    required
                                    id="name"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題2:</div>
                            <h2>常用的 Email</h2>
                            <p>將傳送通知信至此信箱</p>
                            <div class="text-input">
                                <input
                                    type="email"
                                    placeholder="info@elvismao.com"
                                    required
                                    name="email"
                                    id="email"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題3:</div>
                            <h2>學校社團全名</h2>
                            <p>ex:一中數位創作社、中工資訊選手</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="一中數位創作社"
                                    required
                                    name="club"
                                    id="club"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題4:</div>
                            <h2>社團擔任幹部</h2>
                            <p>若無請留空</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="教學"
                                    name="position"
                                    id="position"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題5:</div>
                            <h2>個人檔案</h2>
                            <p>FB, IG, GitHub 等等皆可，讓我們更加認識你</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="https://www.instagram.com/elvisdragonmao/"
                                    name="profile"
                                    id="profile"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題6:</div>
                            <h2>性別</h2>
                            <input
                                type="radio"
                                name="gender"
                                value="male"
                                id="male"
                            />
                            <label for="male" class="radio-input">
                                <div class="radio-index">A</div>
                                Male
                            </label>
                            <input
                                type="radio"
                                name="gender"
                                value="female"
                                id="female"
                            />
                            <label for="female" class="radio-input">
                                <div class="radio-index">B</div>
                                Female
                            </label>
                            <input
                                type="radio"
                                name="gender"
                                value="email"
                                id="other"
                            />
                            <label for="other" class="radio-input">
                                <div class="radio-index">C</div>
                                email
                            </label>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題7:</div>
                            <h2>是否願意兼任社團負責人?</h2>
                            <p>宣傳活動，匯集意見。</p>
                            <input
                                type="radio"
                                name="charge"
                                value="Yes"
                                id="chargeYes"
                            />
                            <label for="chargeYes" class="radio-input">
                                <div class="radio-index">Y</div>
                                Yes
                            </label>
                            <input
                                type="radio"
                                name="charge"
                                value="No"
                                id="chargeNo"
                            />
                            <label for="chargeNo" class="radio-input">
                                <div class="radio-index">N</div>
                                No
                            </label>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題8:</div>
                            <h2>想加入的組別／職位</h2>
                            <p>第一順位</p>
                            <select
                                required
                                name="firstChoice"
                                id="firstChoice"
                            >
                                <option value="會長">會長</option>
                                <option value="副會長">副會長</option>
                                <option value="資訊組">資訊組</option>
                                <option value="公關組">公關組</option>
                                <option value="總務組">總務組</option>
                                <option value="活動組">活動組</option>
                                <option value="臨時工人">臨時工人</option>
                            </select>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題9:</div>
                            <h2>請詳細說明為什麼會想加入這個組別/職位</h2>
                            <p>如欲擔任組長，請於開頭標註組長</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="資訊組長，因為我..."
                                    required
                                    name="reason1"
                                    id="reason1"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題10:</div>
                            <h2>想加入的組別／職位</h2>
                            <p>第二順位</p>
                            <select
                                required
                                name="secondChoice"
                                id="secondChoice"
                            >
                                <option value="會長">會長</option>
                                <option value="副會長">副會長</option>
                                <option value="資訊組">資訊組</option>
                                <option value="公關組">公關組</option>
                                <option value="總務組">總務組</option>
                                <option value="活動組">活動組</option>
                                <option value="臨時工人">臨時工人</option>
                            </select>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題11:</div>
                            <h2>請詳細說明為什麼會想加入這個組別/職位</h2>
                            <p>如欲擔任組長，請於開頭標註組長</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="資訊組長，因為我..."
                                    required
                                    name="reason2"
                                    id="reason2"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question">
                        <div class="question-box">
                            <div class="question-index">問題11:</div>
                            <h2>其他有利於幹部篩選之資訊</h2>
                            <p>個人作品，比賽經歷...</p>
                            <div class="text-input">
                                <input
                                    type="text"
                                    placeholder="我曾經參加過資訊奧林匹亞"
                                    required
                                    name="moreInfo"
                                    id="moreInfo"
                                />
                                <div></div>
                            </div>
                            <button class="next">Next ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question lastQuestion">
                        <div class="question-box">
                            <h2>小提醒</h2>
                            <ul>
                                <li>
                                    一般幹部/組長及新任正副會長將由現任(第三屆)正副會長及組長篩選。
                                </li>
                                <li>
                                    一般幹部/組長/正副會長，每次開會時均須到場，若是缺席嚴重者，主席具有投票開除會籍之權利。
                                </li>
                                <li>記得加入 SCAICT 官方 Discord (下頁連結)</li>
                            </ul>
                            <button class="next send">送出 ❯</button>
                        </div>
                    </div>
                </section>
                <section>
                    <div class="question sending noNav">
                        <div class="question-box">
                            <h2>提交中...</h2>
                        </div>
                        <input
                            type="text"
                            name="DCusername"
                            id="DCusername"
                            style="display: none"
                        />
                    </div>
                </section>
                <section>
                    <div class="question noNav thanks">
                        <div class="question-box">
                            <h2>感謝您的填寫！</h2>
                            <p>
                                我們已經收到您的資料，請留意您的信箱，我們將會寄送通知信給您。
                            </p>
                            <div class="highlight">
                                <h2>加入中電會 Discord 社群</h2>
                                <p>與中電貓和其他電神交流吧w</p>
                                <button
                                    class="discord"
                                    onclick="window.open('https://dc.scaict.org')"
                                >
                                    <img src="/static/discord.svg" alt="" />
                                    加入 Discord
                                </button>
                            </div>
                            <div class="credit"></div>
                        </div>
                    </div>
                </section>
                <nav>
                    <button class="back"><span>❮</span></button>
                    <button class="next skip"><span>❯</span></button>
                </nav>
                <div class="ball-container">
                    <div class="ball ball1"></div>
                    <div class="ball ball2"></div>
                    <div class="ball ball3"></div>
                </div>
            </main>
            <input type="text" name="DCID" id="DCID" style="display: none" />
        </form>
        <script>
            const main = document.querySelector("main");
            let current = 0;

            // save all input form current status to cookie
            const saveStatusToCookie = () => {
                const inputs = document.querySelectorAll("input");
                const selects = document.querySelectorAll("select");
                const radios = document.querySelectorAll('input[type="radio"]');
                const status = {
                    inputs: {},
                    selects: {},
                    radios: {},
                };
                inputs.forEach(input => {
                    status.inputs[input.id] = input.value;
                });
                selects.forEach(select => {
                    status.selects[select.id] = select.value;
                });
                radios.forEach(radio => {
                    status.radios[radio.id] = radio.value;
                });
                // cookie can ony be read from this domain and last form 1 month
                // Convert status object to a JSON string
                const statusString = JSON.stringify(status);

                // Set the cookie with SameSite attribute
                document.cookie = `status=${statusString};max-age=2592000;path=/;SameSite=Lax`;
            };

            // load all input form last status from cookie
            const loadStatusFromCookie = () => {
                const cookie = document.cookie;
                const status = cookie
                    .split(";")
                    .find(c => c.includes("status="));
                if (status) {
                    document.querySelector(".history").style.display = "block";
                    const { inputs, selects, radios } = JSON.parse(
                        status.split("=")[1]
                    );
                    Object.entries(inputs).forEach(([id, value]) => {
                        document.querySelector(`#${id}`).value = value;
                    });
                    Object.entries(selects).forEach(([id, value]) => {
                        document.querySelector(`#${id}`).value = value;
                    });
                    Object.entries(radios).forEach(([id, value]) => {
                        document.querySelector(`#${id}`).checked = true;
                    });
                }
            };

            const nextPage = event => {
                if (event) event.preventDefault();
                saveStatusToCookie();
                // check if all current answer is valid
                const currentQuestion = document.querySelector(
                    `main>section:nth-child(${current})`
                );

                if (currentQuestion) {
                    const inputs = [
                        ...currentQuestion.querySelectorAll("input"),
                        ...currentQuestion.querySelectorAll("select"),
                    ];
                    let invalidInput = false;
                    for (let input of inputs) {
                        if (!input.checkValidity()) {
                            input.classList.remove("invalid");
                            input.offsetWidth;
                            input.classList.add("invalid");
                            invalidInput = true;
                            break;
                        }
                    }
                    if (invalidInput) return;
                }
                main.classList.remove("backward");
                const last = document.querySelector(".last");
                if (last) last.classList.remove("last");
                const latest = document.querySelector(".show");
                if (latest) {
                    latest.classList.remove("show");
                    latest.classList.add("last");
                }
                current++;
                document
                    .querySelector(`main>section:nth-child(${current})`)
                    .classList.add("show");
            };

            nextPage();

            const backBtn = document.querySelector(".back");

            backBtn.addEventListener("click", () => {
                main.classList.add("backward");
                const last = document.querySelector(".last");
                if (last) last.classList.remove("last");
                const latest = document.querySelector(".show");
                if (latest) {
                    latest.classList.remove("show");
                    latest.classList.add("last");
                }
                current--;
                document
                    .querySelector(`main>section:nth-child(${current})`)
                    .classList.add("show");
                saveStatusToCookie();
            });

            const loginBtn = document.querySelector("#loginBtn");
            // discord
            fetch("/user")
                .then(response => response.json())
                .then(user => {
                    if (user) {
                        loginBtn.innerHTML =
                            `<img src="/static/discord.svg" alt="" />以 ` +
                            user.global_name +
                            " 的身分填寫";
                        document.querySelectorAll(".next").forEach(btn => {
                            btn.addEventListener("click", nextPage);
                        });
                        document.getElementById("email").value = user.email;
                        document.getElementById("DCusername").value =
                            user.username;
                        document.getElementById("DCID").value = user.id;
                    } else {
                        loginBtn.innerHTML = `<img src="/static/discord.svg" alt="" />登入 Discord 以繼續`;
                        loginBtn.addEventListener("click", () => {
                            window.location.href = "/auth/discord";
                        });
                    }
                });

            document.querySelector(".send").addEventListener("click", () => {
                saveStatusToCookie();
                const form = document.querySelector("#user-form");
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                fetch("/submit-form", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                })
                    .then(response => response.text())
                    .then(data => {
                        if (data == "送出成功!") {
                            nextPage();
                        } else {
                            // alert response message
                            alert(data);
                        }
                    });
            });
        </script>
    </body>
</html>
